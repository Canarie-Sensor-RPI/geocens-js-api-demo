<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>GeoCENS JS API Demo</title>
  <link rel="stylesheet" href="stylesheets/leaflet.css">
  <!--[if lte IE 8]>
  <link rel="stylesheet" href="stylesheets/leaflet.ie.css">
  <![endif]-->
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      height: 600px;
      width: 100%;
    }

    #chooser {
      position: absolute;
      top: 4em;
      right: 30%;
      left: 30%;
      background-color: white;
      border: 1px solid #888;
      padding: 1em;
      z-index: 50;
      display: none;
    }

    #custom-source {
      display: none;
    }

    #custom_buttons {
      position: absolute;
      top: 1em;
      right: 1em;
      z-index: 50;
    }
  </style>
</head>
<body>
  <div id="chooser">
    <h1>Select a Data Source</h1>
    <p>
      <select id="source">
        <option data-service-url="http://app.geocens.ca:8171/sos" data-offering="Temperature" data-property="urn:ogc:def:property:noaa:ndbc:Water Temperature">NOAA Water Temperature</option>
        <option id="other-source">Other&hellip;</option>
      </select>
    </p>

    <div id="custom-source">
      <p>
        <label for="service_url">Service URL</label><br />
        <input type="text" id="service_url" name="service_url" />
      </p>
      <p>
        <label for="offering">SOS Offering</label><br />
        <input type="text" id="offering" name="offering" />
      </p>
      <p>
        <label for="property">SOS Observed Property</label><br />
        <input type="text" id="property" name="property" />
      </p>
    </div>

    <button id="add-source">Add to Map</button>
  </div>

  <div id="custom_buttons">
    <button id="toggle_chooser">Add Data</button>
  </div>

  <div id="map">
  </div>

  <script src="javascripts/jquery.js"></script>
  <script src="javascripts/leaflet.js"></script>
  <script src="javascripts/geocens.js"></script>
  <script src="javascripts/geocens-map.js"></script>
  <script>
    var $window = $(window),
        $map    = $("#map");

    var autosize = function () {
      $map.height($window.height());
    };

    $window.resize(autosize);

    $(document).ready(function() {
      autosize();
      L.Icon.Default.imagePath = 'images';

      var map = L.map('map', {
            center: [51.07993, -114.131802],
            zoom: 3
      });

      L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);


      $("#toggle_chooser").on("click", function(e) {
        $("#chooser").toggle();
      });

      $("#source").on("change", function(e) {
        var $selection = $(this).children(":selected");
        if ($selection.attr('id') === "other-source") {
          $("#custom-source").show();
        } else {
          $("#custom-source").hide();
        }
      });

      $("#add-source").on("click", function(e) {
        var $selection = $("#source").children(":selected"),
            source;

        if ($selection.attr('id') === "other-source") {
          // Use manual input
          source = {
            service_url: $("#service_url").val(),
            offering:    $("#offering").val(),
            property:    $("#property").val()
          };
        } else {
          // read from data attributes
          source = {
            service_url: $selection.data("service-url"),
            offering:    $selection.data("offering"),
            property:    $selection.data("property")
          };
        }

        $("#chooser").hide();
      });
    }());
  </script>
</body>
</html>
